<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS â€” Automated Competency Assessment System</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           DESIGN SYSTEM â€” Research-Grade + Visual Polish
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        :root {
            --bg: #0a0e1a;
            --bg-panel: #111827;
            --bg-card: #1a2235;
            --bg-input: #0d1220;
            --border: rgba(255, 255, 255, 0.06);
            --border-focus: rgba(99, 102, 241, 0.4);
            --primary: #6366f1;
            --primary-soft: rgba(99, 102, 241, 0.08);
            --accent: #818cf8;
            --success: #34d399;
            --success-bg: rgba(52, 211, 153, 0.08);
            --warning: #fbbf24;
            --warning-bg: rgba(251, 191, 36, 0.08);
            --danger: #f87171;
            --danger-bg: rgba(248, 113, 113, 0.08);
            --text: #e2e8f0;
            --text-2: #94a3b8;
            --text-3: #64748b;
            --radius: 8px;
            --font: 'Inter', system-ui, sans-serif;
            --mono: 'JetBrains Mono', monospace;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: var(--font);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* â”€â”€ HEADER â”€â”€ */
        .header {
            height: 52px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 1.25rem;
            gap: 1.5rem;
            flex-shrink: 0;
        }

        .logo {
            font-weight: 800;
            font-size: 0.95rem;
            letter-spacing: -0.02em;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .logo-badge {
            font-size: 0.6rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            background: var(--primary-soft);
            color: var(--accent);
            border: 1px solid rgba(99, 102, 241, 0.15);
        }

        .header-sep {
            width: 1px;
            height: 20px;
            background: var(--border);
        }

        .header-metrics {
            display: flex;
            gap: 1.5rem;
            flex: 1;
        }

        .h-metric {
            font-size: 0.72rem;
            color: var(--text-3);
            font-family: var(--mono);
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .h-metric b {
            color: var(--text-2);
            font-weight: 500;
        }

        .h-metric .live {
            color: var(--success);
        }

        .h-metric .warn {
            color: var(--warning);
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* â”€â”€ BUTTONS â”€â”€ */
        .btn {
            font-family: var(--font);
            font-size: 0.78rem;
            font-weight: 600;
            padding: 0.45rem 0.9rem;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-2);
            transition: all 0.15s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn:hover {
            background: #1f2c42;
            color: var(--text);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .btn-primary {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #5558e6;
        }

        .btn-primary:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .btn-danger {
            color: var(--danger);
            border-color: rgba(248, 113, 113, 0.2);
            background: var(--danger-bg);
        }

        .btn-danger:hover {
            border-color: var(--danger);
        }

        .btn-sm {
            padding: 0.3rem 0.6rem;
            font-size: 0.7rem;
        }

        .btn-lg {
            padding: 0.65rem 1.5rem;
            font-size: 0.88rem;
            border-radius: 8px;
        }

        /* â”€â”€ SCREEN SYSTEM â”€â”€ */
        .screen {
            display: none;
            flex: 1;
            overflow: hidden;
        }

        .screen.active {
            display: flex;
        }

        /* â•â•â• SETUP SCREEN â•â•â• */
        .setup-screen {
            align-items: center;
            justify-content: center;
            padding: 3rem;
        }

        .setup-container {
            width: 100%;
            max-width: 960px;
        }

        .setup-hero {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .setup-hero h1 {
            font-size: 1.6rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            margin-bottom: 0.5rem;
        }

        .setup-hero h1 span {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .setup-hero p {
            color: var(--text-3);
            font-size: 0.88rem;
            max-width: 520px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .setup-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .setup-card {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .setup-card-label {
            font-size: 0.72rem;
            font-weight: 600;
            color: var(--text-3);
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .setup-card textarea {
            flex: 1;
            min-height: 180px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: var(--mono);
            font-size: 0.78rem;
            line-height: 1.7;
            padding: 0.85rem;
            border-radius: 6px;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s;
        }

        .setup-card textarea:focus {
            border-color: var(--border-focus);
        }

        .setup-card textarea::placeholder {
            color: var(--text-3);
        }

        .setup-actions {
            text-align: center;
        }

        /* Gap Results (inline after analysis) */
        .gap-results {
            display: none;
            margin-bottom: 2rem;
            animation: fadeUp 0.4s ease;
        }

        .gap-results.show {
            display: block;
        }

        .gap-bar {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .gap-score-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .gap-score-num {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--accent);
            font-family: var(--mono);
        }

        .gap-score-label {
            font-size: 0.78rem;
            color: var(--text-3);
        }

        .gap-track {
            flex: 1;
            height: 8px;
            background: var(--bg-card);
            border-radius: 4px;
            overflow: hidden;
        }

        .gap-fill {
            height: 100%;
            border-radius: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.6s ease;
        }

        .gap-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        .chip {
            font-size: 0.7rem;
            font-weight: 500;
            padding: 0.25rem 0.6rem;
            border-radius: 100px;
            border: 1px solid var(--border);
        }

        .chip-match {
            background: var(--success-bg);
            color: var(--success);
            border-color: rgba(52, 211, 153, 0.15);
        }

        .chip-miss {
            background: var(--danger-bg);
            color: var(--danger);
            border-color: rgba(248, 113, 113, 0.15);
        }

        .chip-probe {
            background: var(--warning-bg);
            color: var(--warning);
            border-color: rgba(251, 191, 36, 0.15);
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(12px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        /* â•â•â• INTERVIEW SCREEN â•â•â• */
        .interview-screen {
            flex-direction: row;
        }

        /* Transcript Panel */
        .transcript-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .waveform-bar {
            height: 100px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            position: relative;
            flex-shrink: 0;
        }

        .waveform-bar canvas {
            width: 100%;
            height: 100%;
        }

        .wave-state {
            position: absolute;
            bottom: 8px;
            left: 12px;
            font-family: var(--mono);
            font-size: 0.65rem;
            color: var(--text-3);
            letter-spacing: 0.04em;
        }

        .rec-dot {
            position: absolute;
            top: 10px;
            right: 12px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--danger);
            display: none;
            box-shadow: 0 0 6px var(--danger);
            animation: blink 1s infinite;
        }

        .rec-dot.on {
            display: block;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1
            }

            50% {
                opacity: 0.3
            }
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            scroll-behavior: smooth;
        }

        .messages::-webkit-scrollbar {
            width: 4px;
        }

        .messages::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 2px;
        }

        .msg {
            max-width: 80%;
            line-height: 1.65;
            font-size: 0.88rem;
            animation: fadeUp 0.3s ease;
        }

        .msg-agent {
            align-self: flex-start;
        }

        .msg-user {
            align-self: flex-end;
        }

        .msg-tag {
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
            color: var(--text-3);
        }

        .msg-agent .msg-tag {
            color: var(--accent);
        }

        .msg-body {
            padding: 0.85rem 1rem;
            border-radius: 10px;
            background: var(--bg-card);
            border: 1px solid var(--border);
        }

        .msg-user .msg-body {
            background: var(--primary-soft);
            border-color: rgba(99, 102, 241, 0.12);
        }

        .msg-system {
            align-self: center;
            font-size: 0.75rem;
            color: var(--text-3);
            padding: 0.3rem 0;
        }

        .controls {
            padding: 0.85rem 1.5rem;
            background: var(--bg-panel);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 0.6rem;
            align-items: center;
            justify-content: center;
        }

        .q-progress {
            font-size: 0.72rem;
            color: var(--text-3);
            font-family: var(--mono);
            margin-right: auto;
        }

        /* Scoring Sidebar */
        .scoring-sidebar {
            width: 340px;
            background: var(--bg-panel);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .sidebar-head {
            padding: 0.85rem 1rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.72rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-body {
            flex: 1;
            overflow-y: auto;
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .sidebar-body::-webkit-scrollbar {
            width: 3px;
        }

        .sidebar-body::-webkit-scrollbar-thumb {
            background: var(--border);
        }

        .eval-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.85rem;
            animation: fadeUp 0.3s ease;
        }

        .eval-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.6rem;
        }

        .eval-q {
            font-size: 0.68rem;
            font-weight: 600;
            color: var(--text-3);
            text-transform: uppercase;
        }

        .eval-score {
            font-size: 1rem;
            font-weight: 800;
            font-family: var(--mono);
        }

        .eval-score.high {
            color: var(--success);
        }

        .eval-score.mid {
            color: var(--warning);
        }

        .eval-score.low {
            color: var(--danger);
        }

        .eval-dims {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.35rem;
            margin-bottom: 0.5rem;
        }

        .eval-dim {
            background: rgba(0, 0, 0, 0.2);
            padding: 0.35rem 0.5rem;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: var(--text-2);
        }

        .eval-dim b {
            color: var(--text);
            font-weight: 600;
        }

        .eval-evidence {
            font-size: 0.72rem;
            color: var(--text-3);
            font-style: italic;
            border-left: 2px solid var(--primary);
            padding-left: 0.6rem;
            line-height: 1.5;
        }

        /* Running average */
        .avg-banner {
            padding: 0.85rem 1rem;
            border-top: 1px solid var(--border);
            background: var(--bg-card);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .avg-label {
            font-size: 0.7rem;
            color: var(--text-3);
            text-transform: uppercase;
            font-weight: 600;
        }

        .avg-val {
            font-size: 1.2rem;
            font-weight: 800;
            font-family: var(--mono);
            color: var(--accent);
        }

        /* â•â•â• REPORT OVERLAY â•â•â• */
        .report-overlay {
            position: fixed;
            inset: 0;
            background: rgba(10, 14, 26, 0.92);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .report-overlay.open {
            display: flex;
        }

        .report-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .report-doc {
            background: #fff;
            color: #1a1a2e;
            width: 780px;
            max-height: 88vh;
            overflow-y: auto;
            border-radius: 6px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
            padding: 0;
        }

        /* Academic report styling */
        .rpt-header {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            color: white;
            padding: 2.5rem 3rem 2rem;
            position: relative;
        }

        .rpt-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent), var(--success));
        }

        .rpt-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 0.3rem;
        }

        .rpt-subtitle {
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .rpt-meta {
            display: flex;
            gap: 2rem;
            margin-top: 1.2rem;
            font-size: 0.75rem;
            color: #94a3b8;
        }

        .rpt-meta span b {
            color: white;
        }

        .rpt-body {
            padding: 2rem 3rem 3rem;
        }

        .rpt-section {
            margin-bottom: 2rem;
        }

        .rpt-section h2 {
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: #475569;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.4rem;
            margin-bottom: 1rem;
        }

        .rpt-scores {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .rpt-score-card {
            text-align: center;
            padding: 1.2rem 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .rpt-score-val {
            font-size: 1.8rem;
            font-weight: 800;
            font-family: var(--mono);
            color: #1e293b;
        }

        .rpt-score-label {
            font-size: 0.7rem;
            color: #64748b;
            text-transform: uppercase;
            margin-top: 0.2rem;
        }

        .rpt-overall {
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8fafc, #eef2ff);
            border: 1px solid #c7d2fe;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .rpt-overall-val {
            font-size: 3rem;
            font-weight: 800;
            font-family: var(--mono);
            color: var(--primary);
        }

        .rpt-overall-label {
            font-size: 0.8rem;
            color: #64748b;
        }

        .rpt-rec {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .rpt-rec-hire {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #86efac;
        }

        .rpt-rec-consider {
            background: #fef9c3;
            color: #854d0e;
            border: 1px solid #fde047;
        }

        .rpt-rec-reject {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .rpt-summary {
            font-size: 0.92rem;
            line-height: 1.7;
            color: #334155;
            margin-bottom: 1rem;
        }

        .rpt-two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .rpt-list-title {
            font-size: 0.78rem;
            font-weight: 700;
            color: #166534;
            margin-bottom: 0.5rem;
        }

        .rpt-list-title.warn {
            color: #b45309;
        }

        .rpt-list {
            list-style: none;
            font-size: 0.85rem;
            color: #475569;
            line-height: 1.8;
        }

        .rpt-list li::before {
            content: 'â€¢';
            margin-right: 0.5rem;
            font-weight: bold;
        }

        .rpt-evidence {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .rpt-ev-q {
            font-weight: 700;
            font-size: 0.82rem;
            color: #1e293b;
            margin-bottom: 0.4rem;
        }

        .rpt-ev-a {
            font-size: 0.82rem;
            color: #64748b;
            font-style: italic;
            padding-left: 0.8rem;
            border-left: 2px solid #c7d2fe;
            margin-bottom: 0.5rem;
        }

        .rpt-ev-scores {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .rpt-ev-pill {
            font-size: 0.68rem;
            padding: 0.2rem 0.55rem;
            border-radius: 4px;
            background: #eef2ff;
            color: #4338ca;
            font-weight: 600;
        }

        .rpt-ev-quote {
            font-size: 0.78rem;
            color: #94a3b8;
            margin-top: 0.4rem;
            font-style: italic;
        }

        .rpt-footer {
            text-align: center;
            font-size: 0.72rem;
            color: #94a3b8;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        .rpt-print-btn {
            text-align: center;
            margin-top: 1.5rem;
        }

        .rpt-print-btn button {
            background: #1e293b;
            color: white;
            border: none;
            padding: 0.6rem 2rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-family: var(--font);
            font-size: 0.85rem;
        }

        @media print {

            .report-close,
            .rpt-print-btn {
                display: none !important;
            }

            .report-overlay {
                position: static;
                background: white;
            }

            .report-doc {
                box-shadow: none;
                max-height: none;
                width: 100%;
            }
        }

        /* â”€â”€ Responsive â”€â”€ */
        @media (max-width: 900px) {
            .interview-screen {
                flex-direction: column;
            }

            .scoring-sidebar {
                width: 100%;
                height: 40%;
                border-left: none;
                border-top: 1px solid var(--border);
            }

            .setup-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <!-- â•â•â• HEADER â•â•â• -->
    <header class="header">
        <div class="logo">NEXUS <span class="logo-badge">ACAS v3.1</span></div>
        <div class="header-sep"></div>
        <div class="header-metrics">
            <div class="h-metric">STATUS <b id="hStatus" class="live">â— Ready</b></div>
            <div class="h-metric">LATENCY <b id="hLatency">â€”</b></div>
            <div class="h-metric">Q <b id="hProgress">0/0</b></div>
            <div class="h-metric">AVG <b id="hAvgScore">â€”</b></div>
        </div>
        <div class="header-actions">
            <button class="btn btn-sm" onclick="exportTranscript()">Export</button>
            <button class="btn btn-sm btn-primary" onclick="openReport()">Assessment Report</button>
            <button class="btn btn-sm" onclick="resetAll()">New Session</button>
        </div>
    </header>

    <!-- â•â•â• SCREEN 1: SETUP â•â•â• -->
    <div class="screen setup-screen active" id="screenSetup">
        <div class="setup-container">
            <div class="setup-hero">
                <h1>NEXUS <span>Competency Assessment</span></h1>
                <p>Upload a candidate's CV and the job description. The system will analyze skill gaps and generate a
                    personalized adaptive interview.</p>
            </div>

            <div class="setup-grid">
                <div class="setup-card">
                    <div class="setup-card-label">Candidate Resume / CV</div>
                    <textarea id="cvInput" placeholder="Paste the candidate's CV text here..."></textarea>
                </div>
                <div class="setup-card">
                    <div class="setup-card-label">Job Description</div>
                    <textarea id="jdInput" placeholder="Paste the job description here..."></textarea>
                </div>
            </div>

            <!-- Gap Analysis Results -->
            <div class="gap-results" id="gapResults">
                <div class="gap-bar">
                    <div class="gap-score-row">
                        <div class="gap-score-num" id="gapScoreNum">â€”</div>
                        <div style="flex:1">
                            <div class="gap-score-label">CVâ€“JD Match Score</div>
                            <div class="gap-track">
                                <div class="gap-fill" id="gapFill" style="width:0%"></div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-bottom:0.6rem">
                        <div style="font-size:0.7rem;color:var(--text-3);margin-bottom:0.3rem;font-weight:600">MATCHED
                            SKILLS</div>
                        <div class="gap-chips" id="chipsMatch"></div>
                    </div>
                    <div style="margin-bottom:0.6rem">
                        <div style="font-size:0.7rem;color:var(--text-3);margin-bottom:0.3rem;font-weight:600">MISSING /
                            GAPS</div>
                        <div class="gap-chips" id="chipsMiss"></div>
                    </div>
                    <div>
                        <div style="font-size:0.7rem;color:var(--text-3);margin-bottom:0.3rem;font-weight:600">AREAS TO
                            PROBE</div>
                        <div class="gap-chips" id="chipsProbe"></div>
                    </div>
                </div>
            </div>

            <div class="setup-actions">
                <button class="btn btn-lg btn-primary" id="btnSetup" onclick="runSetup()">Analyze & Initialize</button>
                <button class="btn btn-lg btn-primary" id="btnStart" onclick="startInterview()"
                    style="display:none">Begin Interview â†’</button>
            </div>

            <div style="text-align:center;margin-top:1rem">
                <input id="serverUrl"
                    style="background:var(--bg-input);border:1px solid var(--border);color:var(--text-2);padding:0.4rem 0.8rem;border-radius:6px;font-size:0.75rem;font-family:var(--mono);outline:none;width:280px;text-align:center" />
            </div>
        </div>
    </div>

    <!-- â•â•â• SCREEN 2: INTERVIEW â•â•â• -->
    <div class="screen interview-screen" id="screenInterview">
        <div class="transcript-panel">
            <div class="waveform-bar">
                <canvas id="waveCanvas"></canvas>
                <div class="wave-state" id="waveState">IDLE</div>
                <div class="rec-dot" id="recDot"></div>
            </div>
            <div class="messages" id="msgContainer"></div>
            <div class="controls">
                <div class="q-progress" id="qProgress">Q 0 / 0</div>
                <button class="btn btn-danger" id="btnMic" onclick="toggleMic()">ğŸ¤ Record</button>
                <button class="btn" onclick="openReport()">View Report</button>
            </div>
        </div>
        <div class="scoring-sidebar">
            <div class="sidebar-head"><span>Live Evaluation</span><span id="evalCount">0 scored</span></div>
            <div class="sidebar-body" id="evalFeed"></div>
            <div class="avg-banner">
                <div class="avg-label">Running Average</div>
                <div class="avg-val" id="runAvg">â€”</div>
            </div>
        </div>
    </div>

    <!-- â•â•â• REPORT OVERLAY â•â•â• -->
    <div class="report-overlay" id="reportOverlay">
        <button class="report-close" onclick="closeReport()">âœ•</button>
        <div class="report-doc" id="reportDoc">
            <div class="rpt-header">
                <div class="rpt-title">Competency Assessment Report</div>
                <div class="rpt-subtitle">Generated by NEXUS Automated Competency Assessment System</div>
                <div class="rpt-meta" id="rptMeta"></div>
            </div>
            <div class="rpt-body" id="rptBody">
                <p style="color:#94a3b8">No report data. Complete an interview first.</p>
            </div>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // STATE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let recording = false, connected = false, mediaRec, chunks = [];
        let totalScore = 0, scoreCount = 0, questionNum = 0, totalQuestions = 0;
        let audioCtx, analyser, waveData;
        const API = () => document.getElementById('serverUrl').value.replace(/\/$/, '');

        // Auto-detect server URL (works on Railway AND localhost)
        document.addEventListener('DOMContentLoaded', () => {
            const urlInput = document.getElementById('serverUrl');
            urlInput.value = window.location.origin;
        });

        // DOM
        const msgBox = document.getElementById('msgContainer');
        const evalFeed = document.getElementById('evalFeed');

        // â”€â”€ Auto-connect on load â”€â”€
        window.addEventListener('load', async () => {
            try {
                const r = await fetch(API() + '/health');
                const d = await r.json();
                if (d.status === 'online') { connected = true; document.getElementById('hStatus').innerHTML = 'â— Connected'; }
            } catch (e) { document.getElementById('hStatus').innerHTML = '<span style="color:var(--danger)">â— Offline</span>'; }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SCREENS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if (id === 'screenInterview') initWaveform();
        }
        function startInterview() { showScreen('screenInterview'); addMsg('system', 'Interview session started. Press Record to speak.'); }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SETUP
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function runSetup() {
            const cv = document.getElementById('cvInput').value.trim();
            const jd = document.getElementById('jdInput').value.trim();
            if (!cv || !jd) return alert('Paste both CV and JD.');
            if (!connected) return alert('Not connected to server.');

            const btn = document.getElementById('btnSetup');
            btn.disabled = true; btn.textContent = 'Analyzing...';

            try {
                const fd = new FormData();
                fd.append('cv_text', cv); fd.append('jd_text', jd);
                const r = await fetch(API() + '/setup', { method: 'POST', body: fd });
                const d = await r.json();
                if (d.error) throw new Error(d.error);

                totalQuestions = d.question_count || 0;
                document.getElementById('hProgress').textContent = `0/${totalQuestions}`;

                // Render gap analysis
                const gap = d.gap_analysis || {};
                const score = gap.match_score || 0;
                document.getElementById('gapScoreNum').textContent = score + '%';
                document.getElementById('gapFill').style.width = score + '%';
                document.getElementById('chipsMatch').innerHTML = (gap.matched_skills || []).map(s => `<span class="chip chip-match">${s}</span>`).join('');
                document.getElementById('chipsMiss').innerHTML = (gap.missing_skills || []).map(s => `<span class="chip chip-miss">${s}</span>`).join('');
                document.getElementById('chipsProbe').innerHTML = (gap.probe_areas || []).map(s => `<span class="chip chip-probe">${typeof s === 'object' ? s.area : s}</span>`).join('');
                document.getElementById('gapResults').classList.add('show');

                btn.style.display = 'none';
                const btnStart = document.getElementById('btnStart');
                btnStart.style.display = 'inline-flex';
                btnStart.textContent = `Begin Interview (${totalQuestions} Questions) â†’`;

            } catch (e) { alert('Setup error: ' + e.message); btn.disabled = false; btn.textContent = 'Analyze & Initialize'; }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // WAVEFORM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let wCanvas, wCtx;
        function initWaveform() {
            wCanvas = document.getElementById('waveCanvas');
            wCtx = wCanvas.getContext('2d');
            resizeWave();
            drawWave();
        }
        function resizeWave() { if (wCanvas && wCanvas.parentElement) { wCanvas.width = wCanvas.parentElement.offsetWidth; wCanvas.height = wCanvas.parentElement.offsetHeight; } }
        window.addEventListener('resize', resizeWave);

        function drawWave() {
            requestAnimationFrame(drawWave);
            if (!wCtx || !wCanvas) return;
            const w = wCanvas.width, h = wCanvas.height;
            wCtx.fillStyle = '#111827'; wCtx.fillRect(0, 0, w, h);

            if (!analyser) {
                // Idle line
                wCtx.beginPath(); wCtx.moveTo(0, h / 2); wCtx.lineTo(w, h / 2);
                wCtx.strokeStyle = '#1e293b'; wCtx.lineWidth = 1; wCtx.stroke();
                return;
            }
            analyser.getByteTimeDomainData(waveData);
            wCtx.lineWidth = 2; wCtx.strokeStyle = '#6366f1'; wCtx.beginPath();
            const slice = w / waveData.length;
            let x = 0;
            for (let i = 0; i < waveData.length; i++) {
                const v = waveData[i] / 128.0, y = v * h / 2;
                i === 0 ? wCtx.moveTo(x, y) : wCtx.lineTo(x, y); x += slice;
            }
            wCtx.lineTo(w, h / 2); wCtx.stroke();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RECORDING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function toggleMic() {
            if (recording) stopRec(); else startRec();
        }
        async function startRec() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRec = new MediaRecorder(stream); chunks = [];
                audioCtx = new AudioContext();
                analyser = audioCtx.createAnalyser();
                audioCtx.createMediaStreamSource(stream).connect(analyser);
                waveData = new Uint8Array(analyser.frequencyBinCount);

                mediaRec.ondataavailable = e => chunks.push(e.data);
                mediaRec.onstop = sendAudio;
                mediaRec.start();
                recording = true;
                document.getElementById('btnMic').innerHTML = 'â¹ Stop';
                document.getElementById('recDot').classList.add('on');
                document.getElementById('waveState').textContent = 'RECORDING â€¢ WHISPER-V3';
            } catch (e) { alert('Mic error: ' + e.message); }
        }
        function stopRec() {
            mediaRec.stop(); mediaRec.stream.getTracks().forEach(t => t.stop());
            recording = false;
            document.getElementById('btnMic').innerHTML = 'ğŸ¤ Record';
            document.getElementById('recDot').classList.remove('on');
            document.getElementById('waveState').textContent = 'PROCESSING â€¢ LLAMA-3.3-70B';
            if (audioCtx) { audioCtx.close(); audioCtx = null; } analyser = null;
        }

        async function sendAudio() {
            const blob = new Blob(chunks, { type: 'audio/webm' });
            const fd = new FormData(); fd.append('file', blob, 'input.webm');
            const t0 = Date.now();

            try {
                const res = await fetch(API() + '/chat', { method: 'POST', body: fd });
                const lat = Date.now() - t0;
                document.getElementById('hLatency').textContent = lat + 'ms';

                const transcript = res.headers.get('X-Transcript');
                const response = res.headers.get('X-Response');
                const score = res.headers.get('X-Score');
                const complete = res.headers.get('X-Complete');

                if (transcript) addMsg('user', transcript);
                if (response) addMsg('agent', response);

                // Update progress
                questionNum++;
                document.getElementById('hProgress').textContent = `${questionNum}/${totalQuestions}`;
                document.getElementById('qProgress').textContent = `Q ${questionNum} / ${totalQuestions}`;

                // Score card
                if (score && score !== '') {
                    const s = parseFloat(score);
                    totalScore += s; scoreCount++;
                    const avg = (totalScore / scoreCount).toFixed(1);
                    document.getElementById('runAvg').textContent = avg + '/5';
                    document.getElementById('hAvgScore').textContent = avg;
                    document.getElementById('evalCount').textContent = scoreCount + ' scored';
                    addEvalCard(questionNum, s, transcript);
                }

                // Play audio
                const audioBlob = await res.blob();
                document.getElementById('waveState').textContent = 'SPEAKING â€¢ EDGE-TTS';
                const url = URL.createObjectURL(audioBlob);
                const audio = new Audio(url);
                audio.onended = () => {
                    document.getElementById('waveState').textContent = 'IDLE';
                    URL.revokeObjectURL(url);
                    if (complete === 'true') addMsg('system', 'Interview complete. Click "Assessment Report" to view results.');
                };
                audio.play();

            } catch (e) { addMsg('system', 'Error: ' + e.message); document.getElementById('waveState').textContent = 'ERROR'; }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UI HELPERS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function esc(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }

        function addMsg(role, text) {
            const div = document.createElement('div');
            if (role === 'system') { div.className = 'msg msg-system'; div.textContent = text; }
            else {
                div.className = `msg msg-${role}`;
                div.innerHTML = `<div class="msg-tag">${role === 'agent' ? 'NEXUS' : 'CANDIDATE'}</div><div class="msg-body">${esc(text)}</div>`;
            }
            msgBox.appendChild(div); msgBox.scrollTop = msgBox.scrollHeight;
        }

        function addEvalCard(qNum, score, answer) {
            const cls = score >= 3.5 ? 'high' : score >= 2.5 ? 'mid' : 'low';
            const div = document.createElement('div');
            div.className = 'eval-card';
            div.innerHTML = `
        <div class="eval-head">
            <span class="eval-q">Response ${qNum}</span>
            <span class="eval-score ${cls}">${score.toFixed(1)}</span>
        </div>
        <div class="eval-evidence">${esc((answer || '').substring(0, 120))}${(answer || '').length > 120 ? '...' : ''}</div>
    `;
            evalFeed.insertBefore(div, evalFeed.firstChild);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // REPORT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function openReport() {
            try {
                const r = await fetch(API() + '/report');
                const d = await r.json();
                if (d.error) { alert(d.error); return; }
                renderReport(d);
            } catch (e) { alert('Report error: ' + e.message); }
            document.getElementById('reportOverlay').classList.add('open');
        }
        function closeReport() { document.getElementById('reportOverlay').classList.remove('open'); }

        function renderReport(r) {
            const s = r.rubric_scores || {};
            const rec = r.recommendation || {};
            const recWord = (rec.recommendation || 'N/A').toUpperCase();
            const recCls = recWord.includes('NOT') || recWord.includes('REJECT') ? 'rpt-rec-reject' : recWord.includes('CONSIDER') ? 'rpt-rec-consider' : 'rpt-rec-hire';

            document.getElementById('rptMeta').innerHTML = `
        <span>Session: <b>${r.session_id || 'â€”'}</b></span>
        <span>Questions: <b>${r.questions_answered || 0}</b></span>
        <span>Model: <b>${r.model_info?.llm || 'Llama 3.3 70B'}</b></span>
    `;

            document.getElementById('rptBody').innerHTML = `
        <div class="rpt-overall">
            <div class="rpt-overall-val">${(s.overall || 0).toFixed(1)}<span style="font-size:1.2rem;color:#94a3b8">/5.0</span></div>
            <div class="rpt-overall-label">Overall Competency Score</div>
        </div>

        <div class="rpt-scores">
            ${['relevance', 'depth', 'competency', 'communication'].map(k => `
                <div class="rpt-score-card">
                    <div class="rpt-score-val">${(s[k] || 0).toFixed(1)}</div>
                    <div class="rpt-score-label">${k}</div>
                </div>
            `).join('')}
        </div>

        <div class="rpt-section">
            <h2>Recommendation</h2>
            <div class="rpt-rec ${recCls}">${recWord}</div>
            <p class="rpt-summary">${rec.summary || ''}</p>
            <div class="rpt-two-col">
                <div>
                    <div class="rpt-list-title">âœ“ Strengths</div>
                    <ul class="rpt-list">${(rec.strengths || []).map(x => `<li>${x}</li>`).join('')}</ul>
                </div>
                <div>
                    <div class="rpt-list-title warn">âš  Areas for Development</div>
                    <ul class="rpt-list">${(rec.areas_for_development || rec.weaknesses || []).map(x => `<li>${x}</li>`).join('')}</ul>
                </div>
            </div>
        </div>

        <div class="rpt-section">
            <h2>Per-Question Evidence</h2>
            ${(r.per_question_scores || []).map((q, i) => {
                const sc = q.scores || {};
                const pills = Object.entries(sc).filter(([k, v]) => typeof v === 'object' && v.score !== undefined).map(([k, v]) => `<span class="rpt-ev-pill">${k}: ${v.score}/5</span>`).join('');
                const ev = Object.values(sc).filter(v => typeof v === 'object' && v.evidence).map(v => v.evidence).join(' ');
                return `<div class="rpt-evidence">
                    <div class="rpt-ev-q">Q${i + 1}: ${q.question_text || ''}</div>
                    <div class="rpt-ev-a">${q.answer_text || ''}</div>
                    <div class="rpt-ev-scores">${pills}</div>
                    ${ev ? `<div class="rpt-ev-quote">"${ev}"</div>` : ''}
                </div>`;
            }).join('')}
        </div>

        <div class="rpt-footer">
            Report generated by NEXUS ACAS â€¢ ${new Date().toLocaleString()} â€¢ Research Use Only
        </div>
        <div class="rpt-print-btn"><button onclick="window.print()">Print / Save as PDF</button></div>
    `;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UTILITIES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function exportTranscript() {
            const msgs = msgBox.querySelectorAll('.msg:not(.msg-system)');
            if (!msgs.length) return;
            let txt = `NEXUS ACAS â€” Interview Transcript\nDate: ${new Date().toLocaleString()}\n${'â•'.repeat(50)}\n\n`;
            msgs.forEach(m => { const tag = m.querySelector('.msg-tag')?.textContent || ''; const body = m.querySelector('.msg-body')?.textContent || ''; txt += `[${tag.trim()}]\n${body.trim()}\n\n`; });
            const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([txt], { type: 'text/plain' })); a.download = `nexus-transcript-${Date.now()}.txt`; a.click();
        }

        async function resetAll() {
            try { await fetch(API() + '/reset', { method: 'POST' }); } catch (e) { }
            msgBox.innerHTML = ''; evalFeed.innerHTML = ''; totalScore = 0; scoreCount = 0; questionNum = 0;
            document.getElementById('runAvg').textContent = 'â€”';
            document.getElementById('hAvgScore').textContent = 'â€”';
            document.getElementById('hProgress').textContent = '0/0';
            document.getElementById('hLatency').textContent = 'â€”';
            document.getElementById('gapResults').classList.remove('show');
            document.getElementById('btnSetup').style.display = 'inline-flex';
            document.getElementById('btnSetup').disabled = false;
            document.getElementById('btnSetup').textContent = 'Analyze & Initialize';
            document.getElementById('btnStart').style.display = 'none';
            showScreen('screenSetup');
        }

        // Keyboard shortcut
        document.addEventListener('keydown', e => {
            if (e.code === 'Space' && e.target === document.body && document.getElementById('screenInterview').classList.contains('active')) { e.preventDefault(); toggleMic(); }
        });
    </script>
</body>

</html>